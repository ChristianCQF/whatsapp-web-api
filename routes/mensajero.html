<div class="mensajero">
    <h3>Mini mensajero</h3>
    <form id="sendForm">
        <input type="text" id="numero" placeholder="NÃºmero (sin + ni espacios)" required style="width: 60%;" />
        <input type="text" id="mensaje" placeholder="Mensaje" required style="width: 30%;" />
        <button type="submit">Enviar</button>
    </form>
    <div class="messages" id="messages"></div>
</div>
<script>
    async function fetchMessages() {
        const res = await fetch('/messages');
        const data = await res.json();
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML = '';
        data.messages.slice(-20).forEach(msg => {
            const div = document.createElement('div');
            div.className = 'msg ' + (msg.from.endsWith('@c.us') ? 'other' : 'me');
            div.textContent = msg.from + ': ' + msg.body;
            messagesDiv.appendChild(div);
        });
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    fetchMessages();
    setInterval(fetchMessages, 3000);

    document.getElementById('sendForm').onsubmit = async function(e) {
        e.preventDefault();
        const numero = document.getElementById('numero').value;
        const mensaje = document.getElementById('mensaje').value;
        await fetch('/send', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ numeroDestino: numero, mensaje })
        });
        document.getElementById('mensaje').value = '';
        fetchMessages();
    };
</script>